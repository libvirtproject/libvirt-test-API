# This is a sample for migration testing, it assumes that there is a preinstalled rhel6 guest image file
# named rhel6 located in shared storage. Then on both host side, it needs to mount the shared folder onto
# the default libvirt image folder: /var/lib/libvirt/images

domain:nfs_env
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    nfs_path
        #NFS_PATH#
    mount_path
        #MOUNT_PATH#

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    flags
        0|live

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    flags
        peer2peer|live

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    flags
        peer2peer|tunnelled|live

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    flags
        0|paused

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    flags
        peer2peer|paused

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    flags
        peer2peer|tunnelled|paused

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    flags
        0|persist_dest

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    flags
        peer2peer|persist_dest

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    flags
        peer2peer|tunnelled|persist_dest

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        false
    predstconfig
        true
    postdstconfig
        true
    flags
        0|undefine_source

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        false
    predstconfig
        true
    postdstconfig
        true
    flags
        peer2peer|undefine_source

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        false
    predstconfig
        true
    postdstconfig
        true
    flags
        peer2peer|tunnelled|undefine_source

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    xml
        xmls/migrate_uri.xml
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    xml
        xmls/migrate_uri.xml
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    xml
        xmls/migrate_uri.xml
    migrate_uri
        tcp://#TARGET_MACHINE#:9001
    flags
        peer2peer|live

domain:define
    guestname
        #GUESTNAME#
    uuid
        #STATIC_UUID#
    xml
        xmls/migrate_uri.xml
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:define
    guestname
        #GUESTNAME#
    transport
        ssh
    uuid
        #STATIC_UUID#
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    xml
        xmls/migrate_uri.xml
    diskpath
        #MOUNT_PATH#/libvirt-test-api

domain:start
    guestname
        #GUESTNAME#
    flags
        start_paused

migration:migrate
    transport
        ssh
    target_machine
        #TARGET_MACHINE#
    username
        #TARGET_USER#
    password
        #TARGET_PASSWD#
    guestname
        #GUESTNAME#
    prestate
        paused
    poststate
        paused
    presrcconfig
        true
    postsrcconfig
        true
    predstconfig
        true
    postdstconfig
        true
    xml
        xmls/migrate_uri.xml
    migrate_uri
        tcp://#TARGET_MACHINE#:9001
    params_list
        '{"bandwidth": 2}'
    flags
        peer2peer|live

options cleanup=enable
