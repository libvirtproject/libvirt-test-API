domain:define
    guestname
        #GUESTNAME#
    diskpath
        /var/lib/libvirt/images/libvirt-test-api
    macaddr
        54:52:00:4a:c1:22
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

setVcpus:set_vcpus_config
    guestname
        #GUESTNAME#
    vcpu
        1
    maxvcpu
        #MAXVCPU#

domain:start
    guestname
        #GUESTNAME#

setVcpus:set_vcpus_flags
    guestname
        #GUESTNAME#
    flags
        live|hotpluggable
    vcpu
        2

domain:destroy
    guestname
        #GUESTNAME#

domain:undefine
    guestname
        #GUESTNAME#

installation:install_linux_import
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_iotune
    guestname
        #GUESTNAME#
    total_bytes_sec
        1001
    total_iops_sec
        1001
    size_iops_sec
        1001
    total_bytes_sec_max
        2001
    total_iops_sec_max
        2001
    total_iops_sec_max_length
        2
    total_bytes_sec_max_length
        2

domain:block_iotune
    guestname
        #GUESTNAME#
    read_bytes_sec
        1005
    write_bytes_sec
        1005
    read_iops_sec
        1005
    write_iops_sec
        1005
    size_iops_sec
        1005
    read_bytes_sec_max
        2005
    write_bytes_sec_max
        2005
    read_iops_sec_max
        2005
    write_iops_sec_max
        2005
    read_iops_sec_max_length
        5
    write_iops_sec_max_length
        5
    read_bytes_sec_max_length
        5
    write_bytes_sec_max_length
        5

domain:block_iotune
    guestname
        #GUESTNAME#
    group_name
        test-api-group

domain:destroy
    guestname
        #GUESTNAME#

domain:undefine
    guestname
        #GUESTNAME#

installation:install_linux_import
    guestname
        #GUESTNAME#
    xml
        xmls/setvcpu.xml
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

setVcpus:set_vcpu
    guestname
        #GUESTNAME#
    vcpulist
        2
    state
        enable

setVcpus:set_vcpu
    guestname
        #GUESTNAME#
    vcpulist
        3
    state
        disable

domain:destroy
    guestname
        #GUESTNAME#

domain:undefine
    guestname
        #GUESTNAME#

domain:create
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_commit
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_COMMIT_ACTIVE|VIR_DOMAIN_BLOCK_COMMIT_SHALLOW

domain:block_commit
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_COMMIT_ACTIVE|VIR_DOMAIN_BLOCK_COMMIT_RELATIVE

domain:block_commit
    guestname
        #GUESTNAME#
    bandwidth
        1024
    flags
        VIR_DOMAIN_BLOCK_COMMIT_ACTIVE

domain:block_commit
    guestname
        #GUESTNAME#
    bandwidth
        1048576
    flags
        VIR_DOMAIN_BLOCK_COMMIT_ACTIVE|VIR_DOMAIN_BLOCK_COMMIT_BANDWIDTH_BYTES

domain:destroy
    guestname
        #GUESTNAME#

domain:create
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_copy
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_COPY_SHALLOW|VIR_DOMAIN_BLOCK_COPY_REUSE_EXT
    diskpath
        /tmp/test-api-blockcopy.img

domain:block_copy
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_COPY_REUSE_EXT
    diskpath
        /tmp/test-api-blockcopy-reuse-ext.img

domain:destroy
    guestname
        #GUESTNAME#

installation:install_linux_import
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_copy
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_COPY_TRANSIENT_JOB
    diskpath
        /tmp/test-api-blockcopy-transient-job.img

domain:destroy
    guestname
        #GUESTNAME#

domain:undefine
    guestname
        #GUESTNAME#

installation:install_linux_import
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:set_block_threshold
    guestname
        #GUESTNAME#
    threshold
        1073741824

domain:destroy
    guestname
        #GUESTNAME#

domain:undefine
    guestname
        #GUESTNAME#

domain:create
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_job_abort
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_JOB_ABORT_ASYNC

domain:destroy
    guestname
        #GUESTNAME#

domain:create
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_job_abort
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_JOB_ABORT_PIVOT

domain:destroy
    guestname
        #GUESTNAME#

domain:create
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_job_abort
    guestname
        #GUESTNAME#

domain:destroy
    guestname
        #GUESTNAME#

domain:create
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_pull
    guestname
        #GUESTNAME#
    bandwidth
        1024
    flags
        0

clean

domain:destroy
    guestname
        #GUESTNAME#

domain:create
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_pull
    guestname
        #GUESTNAME#
    bandwidth
        10000000000
    flags
        VIR_DOMAIN_BLOCK_PULL_BANDWIDTH_BYTES

clean

domain:destroy
    guestname
        #GUESTNAME#

installation:install_linux_import
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:undefine
    guestname
        #GUESTNAME#

domain:block_job_info
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_JOB_INFO_BANDWIDTH_BYTES

domain:block_job_info
    guestname
        #GUESTNAME#
    flags
        0

domain:destroy
    guestname
        #GUESTNAME#

domain:create
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_job_set_speed
    guestname
        #GUESTNAME#
    bandwidth
        1024
    flags
        VIR_DOMAIN_BLOCK_JOB_SPEED_BANDWIDTH_BYTES

domain:block_job_set_speed
    guestname
        #GUESTNAME#
    bandwidth
        2048

domain:destroy
    guestname
        #GUESTNAME#

domain:create
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:block_rebase
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_REBASE_COPY|VIR_DOMAIN_BLOCK_REBASE_COPY_DEV
    base
        #SOURCEPATH#
    sourcehost
        #ISCSISOURCEHOST#
    sourcepath
        #ISCSISOURCEPATH#

clean

domain:block_rebase
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_REBASE_COPY|VIR_DOMAIN_BLOCK_REBASE_COPY_RAW
    base
        /tmp/test-api-block-rebase.img

clean

domain:block_rebase
    guestname
        #GUESTNAME#
    flags
        VIR_DOMAIN_BLOCK_REBASE_COPY|VIR_DOMAIN_BLOCK_REBASE_SHALLOW|VIR_DOMAIN_BLOCK_REBASE_REUSE_EXT
    base
        /tmp/test-api-block-rebase.img

clean

domain:block_rebase
    guestname
        #GUESTNAME#
    bandwidth
        1048576
    flags
        VIR_DOMAIN_BLOCK_REBASE_COPY|VIR_DOMAIN_BLOCK_REBASE_BANDWIDTH_BYTES
    base
        /tmp/test-api-block-rebase.img

clean

domain:destroy
    guestname
        #GUESTNAME#

installation:install_linux_import
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:eventloop_register

domain:threshold_event_any
    event_domain
        #GUESTNAME#
    event_runner
        domain:set_block_threshold
    event_id
        VIR_DOMAIN_EVENT_ID_BLOCK_THRESHOLD
    event_runner_params
        '{"guestname": "#GUESTNAME#", "threshold": "1073741824"}'

domain:destroy
    guestname
        #GUESTNAME#

domain:undefine
    guestname
        #GUESTNAME#

installation:install_linux_import
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:domain_event_any
    event_runner
        domain:shutdown_request
    event_id
        VIR_DOMAIN_EVENT_ID_LIFECYCLE
    event_type
        VIR_DOMAIN_EVENT_SHUTDOWN
    event_detail
        VIR_DOMAIN_EVENT_SHUTDOWN_HOST
    event_domain
        #GUESTNAME#
    event_runner_params
        '{"guestname": "#GUESTNAME#", "flags": "host"}'


installation:install_linux_import
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:domain_event_any
    event_runner
        domain:shutdown_request
    event_id
        VIR_DOMAIN_EVENT_ID_LIFECYCLE
    event_type
        VIR_DOMAIN_EVENT_SHUTDOWN
    event_detail
        VIR_DOMAIN_EVENT_SHUTDOWN_GUEST
    event_domain
        #GUESTNAME#
    event_timeout
        30
    event_runner_params
        '{"guestname": "#GUESTNAME#", "flags": "guest"}'

domain:undefine
    guestname
        #GUESTNAME#

domain:detach_device_alias
    guestname
        #GUESTNAME#
    alias_type
        channel
    user_alias
        channel

clean

domain:detach_device_alias
    guestname
        #GUESTNAME#
    alias_type
        disk
    user_alias
        disk

clean

installation:install_linux_import
    guestname
        #GUESTNAME#
    guestarch
        #GUESTARCH#
    guestmachine
        #GUESTMACHINE#
    graphic
        #GUESTGRAPHIC#
    video
        #GUESTVIDEO#

domain:launch_security_info
    guestname
        #GUESTNAME#

domain:destroy
    guestname
        #GUESTNAME#

domain:undefine
    guestname
        #GUESTNAME#

options cleanup=enable
